{#
Macros UI padronizadas para uso em templates.
Importar: {% from 'macros/ui_macros.html' import render_status_badge %}
#}

{# Renderiza badge de status com cores consistentes #}
{# Renderiza badge de status com cores consistentes #}
{% macro render_status_badge(status_text) %}
{# Normaliza√ß√£o: lowercase + trim #}
{% set status = status_text|lower|trim if status_text else '' %}
{% set badge_class = 'bg-secondary' %}
{% set is_unknown = true %}

{# Mapeamento de Cores #}
{%- if status in ['novo', 'aberto', 'ativo'] -%}
{% set badge_class = 'bg-primary' %}
{% set is_unknown = false %}
{%- elif status in ['em andamento', 'execu√ß√£o', 'execucao', 'pendente'] -%}
{% set badge_class = 'bg-warning text-dark' %}
{% set is_unknown = false %}
{%- elif status in ['conclu√≠do', 'concluido', 'finalizado', 'pago', 'aprovado', 'spare'] -%}
{% set badge_class = 'bg-success' %}
{% set is_unknown = false %}
{%- elif status in ['cancelado', 'reprovado', 'erro', 'recusado', 'inativo'] -%}
{% set badge_class = 'bg-danger' %}
{% set is_unknown = false %}
{%- endif -%}

{# Fallback visual: borda laranja para status desconhecidos #}
{% set unknown_indicator = 'border border-warning' if is_unknown and status else '' %}

{# L√≥gica do Carimbo: S√≥ aplica se for Status Final/Sucesso #}
{% set anim_class = 'stamp-pop' if badge_class == 'bg-success' else '' %}

<span class="badge {{ badge_class }} {{ anim_class }} {{ unknown_indicator }}" {% if is_unknown and status
    %}title="Status n√£o mapeado: {{ status_text }}" {% endif %}>
    {{ status_text }}
</span>
{% endmacro %}

{# Renderiza navega√ß√£o breadcrumb #}
{% macro render_breadcrumb(items) %}
<nav aria-label="breadcrumb" class="mb-3">
    <ol class="breadcrumb mb-0">
        {% for item in items %}
        {% if loop.last %}
        <li class="breadcrumb-item active" aria-current="page">{{ item.label }}</li>
        {% else %}
        <li class="breadcrumb-item"><a href="{{ item.href }}" class="text-decoration-none">{{ item.label }}</a></li>
        {% endif %}
        {% endfor %}
    </ol>
</nav>
{% endmacro %}

{# Renderiza badge de pagamento #}
{% macro render_payment_badge(is_paid) %}
{% if is_paid %}
<span class="badge bg-success"><i class="bi bi-check-circle me-1"></i>Pago</span>
{% else %}
<span class="badge bg-warning text-dark"><i class="bi bi-clock me-1"></i>Pendente</span>
{% endif %}
{% endmacro %}

{# Formata valor monet√°rio #}
{% macro money(value, prefix='R$ ') %}
{{ prefix }}{{ "%.2f"|format(value|float if value else 0) }}
{% endmacro %}

{# C√©lula de a√ß√µes com espa√ßamento padronizado #}
{% macro action_cell() %}
<td class="cell-actions">{{ caller() }}</td>
{% endmacro %}

{# Estado vazio para tabelas/listas sem dados #}
{% macro render_empty_state(message, icon='bi-inbox', cta_text=None, cta_url=None) %}
<div class="empty-state text-center py-5">
    <i class="bi {{ icon }} display-1 text-muted opacity-50"></i>
    <h4 class="mt-4 text-muted fw-bold">{{ message }}</h4>
    {% if cta_text and cta_url %}
    <a href="{{ cta_url }}" class="btn btn-primary btn-lg mt-3">
        <i class="bi bi-plus-lg me-1"></i>{{ cta_text }}
    </a>
    {% endif %}
</div>
{% endmacro %}

{# Sauda√ß√£o e Cabe√ßalho do Dashboard #}
{% macro render_greeting(user_name) %}
<div class="greeting-header shadow-sm d-flex align-items-center justify-content-between">
    <div>
        <h2 class="h3 fw-bold text-dark mb-1">
            <span id="saudacaoTexto">Ol√°</span>, {{ user_name }}! üëã
        </h2>
        <p class="text-muted mb-0 small">Aqui est√° o resumo da sua opera√ß√£o hoje.</p>
    </div>
    <div class="d-none d-md-block text-end">
        <small class="text-muted d-block text-uppercase fw-bold" style="font-size: 0.7rem;">Data de Hoje</small>
        <span class="fs-5 fw-bold text-dark" id="dataAtual">--/--</span>
    </div>
</div>
{% endmacro %}